# 第三章

## 数据链路层的基本概念以及基本问题
    1. 基本概念：
        数据链路层使用的信道：
            点对点信道：使用一对一的点对点的信道(两台主机的连接)

            广播信道：使用一对多的广播通信方式，过程比较复杂。广播信道连接的主机很多，所以需要使用专用的信道共享协议
                     来协调数据的发送（通过集线器连接）
        
        链路与数据链路：
            链路：是一条点对点的物理线段，中间没有其他连接点
                一条链路只是一条通路的一个组成部分

            数据链路：除了物理线路还需要通信协议来控制数据的传输。若把实现这些协议的硬件和软件加到链路上，这就构成了
                     数据链路

                常用适配器（网卡）来实现这些协议的硬件和软件
                一般的适配器都包括了数据链路层和物理层这两层的功能

        帧：
            数据链路层传送的是帧
            
            数据链路层就像一个数字管道：常常在对等的数据链路层之间画出一个数字管道，管道上传输的单位就是帧

    2. 三个基本问题：
        封装成帧：将传过来的数据添加一个开始的标记（首部）和添加一个结束的标记（尾部）就构成了一个帧。可以确定帧的界限
                  首部和尾部的一个重要作用就是进行帧定界（计算机接收数据是通过首部和尾部来确定个数据的完整性）

        透明传输：由封装成帧引起的问题, 在数据部分出现了帧的开始或者结束的字符, 需要通过转义字符ESC来进行标记, 对数据
                  部分的帧的开始字符, 结束字符使用转义字符进行转义, 网卡在接收到数据时就会将转义字符去掉得到没有改变
                  的传输数据, 所以叫透明传输
                
            实现透明传输的方法：
                字符填充法: 利用转义字符如ESC来进行对非标记字符进行转义, 接收端则将这个转义字符去掉

                零比特填充法：假如帧首和帧尾都是01111100, 则对于数据部分如果出现了连续的5个1, 则在1的后面填充一个0

                违规编码法: 假如我们对基带信号的编码为曼彻斯特编码, 那么左高右低则为0, 左低右高则为1, 这时可以将帧首
                           和帧尾用左低右低或者左高右高的违规编码方式来表示

        差错控制：
            传输过程中因为存在干扰可能会产生比特差错, 1可能变成0而0也可能变成1, 当发现了传过来的这个帧有错误时, 
            此时该数据链路层(可能是路由器的数据链路层)就会将这个帧丢弃, 当源计算机在一定的传输时间过去后还没有收到
            目标计算机的确认信息时，就会重新发送一次该丢弃的帧
            
            实现差错控制: 通过CRC循环冗余检验算法获得帧检验序列FCS
                实现基本思想：CRC算法的基本思想是将传输的数据当做一个位数很长的数。将这个数除以另一个数。得到的余数
                             作为校验数据附加到原数据后面
                
                实现：通过生成多项式形成被除数和除数，被除数即要发送的数据加上(除数位数 - 1)个0，例如被除数为101001，
                     除数为1101,则被除数为101101加上3个0即101001000，然后对被除数和除数进行异或运算, 如果此时不够
                     位数则与0000进行异或运算

                CRC特点: 
                     1. 这种检测方法并不能确定究竟是哪些个比特出现了差错, 使用位数足够多的除数P, 那么出现检测不到的
                        差错的概率就很小很小

                     2. 使用该技术只能做到无差错接收数据, 即只接收正确的数据（是一种无比特差错）

## 两种情况下的数据链路层
    1. 使用点对点信道的数据链路层(PPP)
        PPP协议:用户使用ADSL拨号上网一般使用PPP协议。（具有身份验证和统计计费功能）
            * 应该满足的要求：
                简单（首要要求），封装成帧，透明性，多种网络层协议，多种类型链路，差错检查，检测连接状态，最大传输单
                元，网络层地址协商，数据压缩协商
            
            * 不需要满足的要求：
                纠错，流量控制，序号，多点线路，半双工或单工链路

            * PPP协议已成为因特网的正式标准
            
            * PPP协议的组成部分：
                1. 数据链路层协议可以用于异步串行或同步串行介质
                2. 它使用LCP（链路控制协议）建立并维护数据链路连接（负责身份验证）
                3. 网络控制协议（NCP）允许在点到点连接上使用多种网络层协议
            
            * PPP协议的帧格式：首部     信息部分    尾部

            * PPP协议的工作状态：
                当用户拨号接入IPS时，路由器的调制解调器对拨号做出确认，并建立一条物理连接。PC机向路由器发送一系列的
                PPP参数（封装成多个PPP帧）这些分组及其响应选择一些PPP参数，和网络层进行配置,NCP给新接入的PC机分配一
                个临时的IP地址，使PC机成为因特网上的一个主机。通信完毕时，NCP释放网络层连接，收回原来分配出去的IP地址。
                然后，LCP释放数据链路层连接。最后释放物理层连接。

            
    2. 使用广播信道的数据链路层（ESMA/CD）
        局域网的拓扑：星形网（现在基本上都还是星形），总线网（缺点：彼此联系比较紧密）、环形网、树形网

        局域网的特点：网络为一个单位拥有，且地理范围和站点数目均有限
        局域网的优点：
            1. 具有广播功能，从一个站点可以访问全网
            2. 提高系统的可靠性，可用性，生存性
            3、便于系统扩展，设备位置可以灵活变通
        
        认识以太网：
            最初的以太网是将许多计算机连在一根总线上。具有广播特性的总线上实现了一对一的通信
        
        以太网如何实现通信：
            使用载波监听多点接入/碰撞检测，即使用CSMA/CD协议
                多点接入：表示许多计算机以多点接入的方式连接在一根总线上

                载波监听：是指每一个站在发送数据之前首先要检测一下总线上是否有其他计算机在发送数据，如果有则暂时不发送
                          数据，以免发生数据碰撞。

                碰撞检测：就是计算机边发送数据变检测信道上的信号电压大小。

            CSMA/CD协议的重要特性：
                使用该协议的以太网不能进行全双工通信而只能实现双向交替通信（半双工通信）

    3. 以太局域网（以太网）
        概述：
            以太网提供的服务是不可靠的交付。当接收站收到有差错的数据帧时就丢弃这个帧，其他什么也不做。差错的纠正由高层
            来决定。（即发送数据方决定）

        集线器连接的拓扑：
            使用集线器的以太网在逻辑上仍是一个总线网，各工作站使用的还是CSMA/CD协议，并共享逻辑上的总线
            集线器很像一个多接口的转发器，工作在物理层

        信道利用率

        MAC层：
            在局域网中,硬件地址，又称为物理地址，或MAC地址。MAC地址实际上就是适配器地址或适配器标识符EUI-48（MAC地址
            是唯一的）

            cmd中查询MAC地址：ipconfig /all
            
            如何修改MAC地址：
                控制面板---->网络和Internet------->网卡------>属性----->配置------>高级----->网络地址（进行修改）
            
            MAC帧格式：MAC最低64个字节
                目的地地址（6个字节）源地址（6个字节）类型（2个字节）数据（46-1500个字节）FCS（4个字节）

                无效MAC帧:
                    1. 帧的长度不是整数个字节
                    2. 数据字段的长度不在46~1500字节之间，有效的MAC帧长度为64~1518字节之间
                    3. 用收到的帧检验序列FCS查出有差错

    4. 扩展以太网：
        物理层考虑扩展：利用光纤（集线器）
            用集线器扩展局域网优点：
                1. 使原来属于不同碰撞域的局域网上的计算机能够进行跨碰撞域的通信
                2. 扩大了局域网覆盖的地理范围

            用集线器扩展局域网缺点：
                1. 碰撞域大了，但总的吞吐量并未提高
                2. 如果不同的碰撞域使用不同的数据率，就不能用挤线器连接起来
        
        在数据链路层考虑扩展：利用网桥
            网桥工作在数据链路层，根据MAC帧的目的地址对收到的帧进行转发
            
            网桥具有过滤帧的功能（会判断MACA地址是否在同一边）。当它收到一个帧时，不会向所有接口转发这个帧，会先检查MAC
            地址，然后确定发到哪一个接口。
            
            网桥的优点：
                1. 过滤通信量
                2. 扩大了物理范围
                3. 提高了可靠性
                4. 可互连不同物理层、不同MAC子层和不同速率的局域网
            
            网桥的缺点
                1. 存储转发增加了延迟
                2. 在MAC子层并没有流量控制功能
                3.具有不同MAC子层的网桥桥接在一起时时延更大
            
            透明网桥：“透明”指局域网上的站点不知道自己经过了几个网桥，网桥对他们来说是看不见的

            交换机：交换机内部的CPU会在每个端口成功连接时，通过将MAC地址和端口对应，形成一张MAC表，在通信时，
                    只将数据报发送到指定MAC地址的计算机，从而避免了大量广播。

            cmd命令：shutdown -m \\ip地址 -r     远程重启计算机

    5. 虚拟局域网：
        LAN:局域网
        VLAN:虚拟局域网
            一个交换机两个VLAN：这个技术相当于将交换机分为了独立的两部分，提供给不同部门的人使用，两部门之间能通信
            两个交换机两个VLAN：相当于分别将这两个交换机都切分为2部分，然后每个VLAN之间的计算机通过干道链路来进行连接
            交互
        
        。。。

    6. 高速以太网：速率达到100MB/S的以太网被称为高速以太网。 
